{% extends 'book/base_with_header.html' %}
{% load static%}

{% block content %}

<div class="book-detail">
    <div class="book-image-wrap lazy-container">
        <img class="lazy" data-original="{{ object.thumbnail_image.url }}">
    </div>

    <div class="detail-right">
        <div class="detail-right-header">
            <ul class="tags">
                {% for tag in object.tag.all %}
                <li class="tag-item"><a href="{% url 'book:list' %}?tag={{tag.content}}">{{tag.content}}<span>{{tag.book_count}}</span></a>
                </li>
                {% endfor %}
            </ul>
            <a href="{% url 'book:update' book.id %}" class="tag-edit-a"><i class="material-icons tag-edit-icon">
                edit
            </i><span class="tag-edit-text">編集する<span></a>
        </div>

        <div class="title">
            {{ object.title }}
        </div>
        <div class="authors-wrap">
            {% for author in object.author.all %}
            <a href="#">{{author.name}}</a>,
            {% endfor %}
        </div>

        <div class="else-info">
            <ul>
                <li>{{ object.page_count }}ページ</li>
                <li>{% if object.status == 0 %} 処理中...
                    {% else %} アップロード済み
                    {% endif %}
                </li>
            </ul>
        </div>

        <div class="flex-margin"></div>

        <div class="buttton-area">

            <!--{% if object.pdf_file %}-->
            <!--<a href="{{ object.pdf_file.url }}" class="square_btn">PDFで開く</a>-->
            <!--{% else %}-->
            <!--<a href="#" class="square_btn not_found">PDFが見つかりません</a>-->
            <!--{% endif %}-->


            {% if object.zip_file %}
            <a href="{{ object.zip_file.url }}" class="square_btn">zipでダウンロード</a>
            {% else %}
            <a href="#" class="square_btn not_found">zipが見つかりません</a>
            {% endif %}

            <!--<a href="#" class="square_btn">ビューワーを開く</a>-->
        </div>

    </div>
</div>

<div class="book-viewer">
    <div class="viewer-area horizontal-list lazy-container">
        {% for book_image in object.images.all %}
        <li class="item">
            <img class="lazy" src="{% static 'book/images/loading.png' %}" data-original="{{ book_image.image.url }}"
                 width="100%">
        </li>
        {% endfor %}
    </div>
</div>


{% endblock %}


{% block extrajs %}
{{ block.super }}
<script src="{% static 'lib/js/jquery.lazyload.js' %}"></script>
<script src="{% static 'lib/js/jquery.scrollstop.js' %}"></script>
<!--<script src="{% static 'lib/js/jquery.tagsinput-revisited.js' %}"></script>-->

<script type="text/javascript">

    nnnn = "{% for tag in object.tag.all %}{{tag.content}} {% endfor%}".split(' ').filter(v => v != "")

    $(function () {
        $('.lazy-container').each((index, container) => {
            console.log(container);
            $(container).find('img.lazy').lazyload({
                threshold: 500,    // 読み込み閾値 px
                effect: 'fadeIn',  // 読み込みエフェクトも指定できる
                container: container,
            });
        });

    });
</script>

{% endblock %}

{% block extracss %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'book/css/bookdetail.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'lib/css/jquery.tagsinput-revisited.css' %}"/>
<style>
    .container {
        width: 100%;
        margin: 0;
        padding: 0;
        max-width: none;
    }

    .tag-edit-a {
        position: relative;
    }

    .tag-edit-text {
        font-size: 15px;
        color: #c2c0c2;
        position: absolute;
        top: 10px;
        width: 100px;
    }

    .tag-edit-icon {
        font-size: 30px;
        color: #c2c0c2;
        position: relative;
        display: inline-block;
        height: 38px;
        line-height: 35px;
        background-color: #fff;
        border-radius: 6px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        text-decoration: none;
        -webkit-transition: .2s;
        transition: .2s;
    }

    .tag-edit-icon:hover {
        cursor: pointer;
    }

    .horizontal-list {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        padding: 40px 60px;
    }

    .item {
        /* 横スクロール用 */
        display: inline-block;
        /* 見た目調整 */
        /*width: 279px;*/
        height: 500px;
        width: auto;
        margin: 16px 40px 16px 0;
        font-size: 48px;
        /*background: rgba(255, 0, 0, 0.4);*/
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);
    }

    .item img {
        height: 500px;
        width: auto;
    }

    .book-viewer {
        margin: 200px 0 90px 0;
        background-color: #525659;
        box-shadow: 0px 1px 10px 0px inset;
    }

    .detail-right-header {
        display: flex;
        flex-direction: row;
    }


</style>

{% endblock %}